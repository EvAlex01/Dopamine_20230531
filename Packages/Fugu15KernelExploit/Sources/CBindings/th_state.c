//
//  th_state.h
//  kexploitd
//
//  Created by Linus Henze.
//  Copyright Â© 2022 Pinauten GmbH. All rights reserved.
//

#include <stdint.h>
#include <mach/mach.h>

#ifdef __arm64__

#include <ptrauth.h>

uint64_t thread_state64_get_pc(const arm_thread_state64_t *ts) {
    return arm_thread_state64_get_pc(*ts);
}

void thread_state64_set_pc(arm_thread_state64_t *ts, uint64_t pc) {
    void *ptr = ptrauth_sign_unauthenticated((void*)pc, ptrauth_key_function_pointer, 0);
    arm_thread_state64_set_pc_fptr(*ts, ptr);
}

uint64_t thread_state64_get_lr(const arm_thread_state64_t *ts) {
    return arm_thread_state64_get_lr(*ts);
}

void thread_state64_set_lr(arm_thread_state64_t *ts, uint64_t lr) {
    void *ptr = ptrauth_sign_unauthenticated((void*)lr, ptrauth_key_function_pointer, 0);
    arm_thread_state64_set_lr_fptr(*ts, ptr);
}

#endif /* defined __arm64__ */
